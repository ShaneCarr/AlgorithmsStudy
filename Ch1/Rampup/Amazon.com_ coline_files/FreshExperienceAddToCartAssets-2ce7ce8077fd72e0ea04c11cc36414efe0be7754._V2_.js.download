(function(g){var f=window.AmazonUIPageJS||window.P,k=f._namespace||f.attributeErrors,b=k?k("FreshExperienceAddToCartAssets"):f;b.guardFatal?b.guardFatal(g)(b,window):b.execute(function(){g(b,window)})})(function(g,f,k){g.when("A","jQuery","a-button").register("fx-atfc-button-utils",function(b,a,c){var d=!1;return{hideButtonAndRenderSpinner:function(b){var c=b.$currentTarget.find(".a-button");c&&c.length&&(d=!0,b="atfc-spinner-"+b.data.asin,c.wrap('<div id="'+b+'" class="atfc-spinner"></div>'),a("#"+
b).css({width:c.outerWidth()+"px"}),a("#"+b).css({height:c.outerHeight()+"px"}),c.css("visibility","hidden"))},showButtonAndRemoveSpinner:function(b){var c=b.$currentTarget.find(".a-button");b=a("#atfc-spinner-"+b.data.asin);c&&c.length&&b&&b.length&&(d=!1,c.css("visibility","visible"),c.unwrap())},shouldDisableButtonClicks:function(){return d}}});g.when("fresh-shared-add-to-cart","ready").register("fresh-add-to-cart",function(b){return{addToFreshCart:function(a){b.addToFreshCart(a,"desktop")}}});
g.when("A").register("afx-uatc-proxy",function(b){return function(a){var c="/gp/add-to-cart/json";a.reftag!==k&&(c+="/ref="+a.reftag);b.post(c,{timeout:5E3,params:{"session-id":a.sessionID,clientName:"SharedFreshHandler",nextPage:"cartitems",ASIN:a.asin,offerListingID:a.offerListingID,useUber:"1",source:"Fresh",ruleSet:"FreshGet"},success:a.success,error:a.error})}});g.when("A").register("afx-get-cart-count",function(b){return function(a){b.post("/gp/api/cart/1.0/get-cart-count.json",
{timeout:5E3,params:{sessionID:a.sessionID,clientName:"SharedFreshHandler"},success:a.success,error:a.error})}});g.register("afx-csm-metrics-utils",function(){var b={},a=function(a,b){f.ue&&f.ue.count&&a&&b&&f.ue.count(a,b)};return{startWidgetTimer:function(a){b[a]=Date.now()},endWidgetTimer:function(c,d){var e=Date.now()-b[c];a(d,e)},setWidgetClickTimestamp:function(a){f.ue&&f.uet&&a&&f.uet("tc",a,{wb:1})},setWidgetTimestamp:function(a,b){f.ue&&f.uet&&a&&b&&f.uet(a,b,{wb:1})},increment:function(a){f.ue&&
f.ue.count&&a&&f.ue.count(a,(f.ue.count(a)||0)+1)},setCount:a,sendWidgetMetrics:function(a){f.ue&&f.uex&&a&&f.uex("ld",a,{wb:1})}}});g.register("afx-metrics-helper",function(){var b={ATFC_COUNT:"afxAddToFreshCartCount",ATFC_SUCCESSFUL_ADD_COUNT:"afxAddToFreshCartSuccessfulAddCount",ATFC_ERROR_MODAL_COUNT:"afxAddToFreshCartErrorModalCount",ATFC_UNEXPECTED_ERROR_COUNT:"afxAddToFreshCartUnexpectedErrorCount",ATFC_LATENCY_SCOPE:"afxAddToFreshCartLatencyScope",ATFC_CTCF:"afxAddToFreshCartCTCF",
CLEAR_SLOT_ATFC_CTCF:"afxClearSlotAndAddToFreshCartCTFC",CART_SERVICE_RESPONSE_FALSE:"afxCartServiceResponseIsNotOKErrorCount",ITEM_NOT_AVAILABLE:"afxItemNotAvailableErrorModalCount",ITEM_PARTIALLY_AVAILABLE:"afxItemPartiallyAvailableErrorModalCount",ITEM_PARTIALLY_AVAILABLE_FOR_RESERVATION:"afxItemPartiallyAvailableErrorModalCount",ADDRESS_NOT_SELECTED:"afxAddressNotSelectedErrorCount",INPUT_INVALID:"afxGeneralErrorModalCount",ITEM_NOT_AVAILABLE_FOR_RESERVATION:"afxItemNotAvailableForReservationErrorModalCount",
INTERNAL_SERVER_ERROR:"afxGeneralErrorModalCount",PRICE_UNAVAILABLE:"afxItemNotAvailableErrorModalCount",QUANTITY_OVERFLOW:"afxUniqueItemQuantityOverflowErrorModalCount"};return{getMetricsForDevice:function(a){var c={};Object.keys(b).forEach(function(d){c[d]=b[d]+":"+a});return c}}});g.when("A","jQuery","a-modal","afx-uatc-proxy","afx-get-cart-count","fx-atfc-button-utils","afx-csm-metrics-utils","afx-metrics-helper","ready").register("fresh-shared-add-to-cart",function(b,a,c,d,e,x,h,
t){var m;g.when("EWC").execute("add-to-cart-refresh",function(a){m=a});g.when("nav.getFlyout").execute(function(a){a("ewc")});var y={"itemPrice:priceUnavailable:1":"PRICE_UNAVAILABLE","itemDeleted:itemCountOverflow:6":"QUANTITY_OVERFLOW"};return{addToFreshCart:function(n,q){function l(d,e){var h=e||{},f=d.data.sessionID;h.title=d.data.title;h.asin=d.data.asin;h.offerListingID=d.data.offerListingID;h.sessionID=f;var h=a.param(h),g=c.create(d.$currentTarget,{name:"fresh-add-to-cart-modal",url:"/afx/cart/reservation_conflict?"+
h});b.on("a:popover:afterUpdatePosition:fresh-add-to-cart-modal",function(a){g.update(b.state("modalAttributes")||{})});g.show();a("#a-popover-lgtbox").css("position","fixed");g.$container.css("position","fixed");b.on("a:popover:afterHide:fresh-add-to-cart-modal",function(a){u(f);c.remove(a.popover);b.state.replace("modalAttributes",null)})}function v(a){return a.filter(function(a){return a.statusKey in y})}function z(a,b,c){c+=" returned by UATC is not an array";g.log(c,"Error",b);l(a);n.error(a,
"","",c)}function A(b,c){var e=b.data.asin,f=b.data.offerListingID,m=b.data.sessionID,q=b.data.reftag;a.each({title:b.data.title,asin:e,offerListingID:f,sessionID:m},function(a,c){c===k&&(g.log("fresh-add-to-cart required parameter is missing","Error",a),l(b),n.error(b,void 0,void 0,void 0))});d({asin:e,offerListingID:f,sessionID:m,reftag:q,success:function(d){var e;d&&d.isOK?(e=d.extraErrorInfos)&&e.constructor===Array&&0<e.length?e=!0:(e=d.statusList,e=e&&e.constructor===Array&&0<e.length?(e=v(e))&&
0<e.length:!1,e=e?!0:!1):(!d.isOK&&h.increment(p.CART_SERVICE_RESPONSE_FALSE),e=!0);e?(h.increment(p.ATFC_ERROR_MODAL_COUNT),d?d.isOK?(e=d.extraErrorInfos,d=d.statusList,e&&e.constructor!==Array?z(b,e,"extraErrorInfos"):0<e.length?!e||0>=e.length||(d=e[0],"ADDRESS_NOT_SELECTED"===d.statusCode?(h.increment(p.ADDRESS_NOT_SELECTED),d=a.param({asin:b.data.asin,offerListingID:b.data.offerListingID,quantity:1,redirectURL:document.location.href,ref:"afx_atfc_noaddress"}),document.location.href="/afx/nc/chooseaddress?"+
d):(d.itemStatusCode in p&&h.increment(p[d.itemStatusCode]),l(b,{reasonCode:d.itemStatusCode,quantityAdded:d.availableQuantity,quantityRequested:d.requestedQuantity}))):d&&d.constructor!==Array?z(b,d,"statusList"):0<d.length&&d&&!(0>=d.length)&&(d=v(d))&&0<d.length&&(d=y[d[0].statusKey],l(b,{reasonCode:d}),h.increment(p[d]))):(l(b),n.error(b,"","","isOK returned by UATC is false")):(l(b),n.error(b,"","","No response from UATC"))):(h.increment(p.ATFC_SUCCESSFUL_ADD_COUNT),c(d,m));x.showButtonAndRemoveSpinner(b)},
error:function(a,c,d){h.increment(p.ATFC_UNEXPECTED_ERROR_COUNT);l(b);n.error(b,a,c,d);x.showButtonAndRemoveSpinner(b)}})}function C(a){var c=p.ATFC_LATENCY_SCOPE+Date.now();h.startWidgetTimer(c);var d={token:(b.state("baseWidgetState")||{}).csrfToken};b.post("/afx/slotselection/cancel",{timeout:5E3,params:d,success:function(){A(a,function(a,b){var d=p.CLEAR_SLOT_ATFC_CTCF+":lineItemBucket:"+(a.items&&Math.ceil(a.items.length/5));h.endWidgetTimer(c,d);location.reload()})},error:function(){g.log("Failed to clear reservation")}})}
function r(a){e({sessionID:a,success:function(a){a&&a.isOK&&a.total&&w(a.total.numActiveItem)},error:function(){g.log("Failed to get cart count","Error",a)}})}function w(a){g.when("nav.setCartCount").execute(function(b){b(a)});g.when("mash").execute(function(b){b.cart&&"function"===typeof b.cart.didUpdate&&b.cart.didUpdate({newCartQuantity:a})})}function u(a){m!==k&&"function"===typeof m.refresh?m.refresh():r(a)}var p=t.getMetricsForDevice(q);b.declarative("fresh-clear-slot","click",function(a){C(a)});
b.declarative("fresh-add-to-cart","click",function(a){var b=p.ATFC_LATENCY_SCOPE+Date.now();h.startWidgetTimer(b);x.shouldDisableButtonClicks()||a.$currentTarget.find("input").is(":disabled")||(x.hideButtonAndRenderSpinner(a),f.amazon&&f.amazon.cordova&&f.amazon.cordova.notification&&f.amazon.cordova.notification.vibrate&&f.amazon.cordova.notification.vibrate(50),h.increment(p.ATFC_COUNT),A(a,function(c,d){var e=p.ATFC_CTCF+":lineItemBucket:"+(c.items&&Math.ceil(c.items.length/5));h.endWidgetTimer(b,
e);u(d);n.success(a,c)}))})}}})});